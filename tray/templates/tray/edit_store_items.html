{% extends "tray/store_homepage_layout.html" %}

{% block title %} Order {% endblock %}





{% block content %}
<center>
<script>
    function validateForm() {
                var item_name = document.forms["form"]["item_name"].value;
                var price = document.forms["form"]["price"].value;
                var stock = document.forms["form"]["stock"].value;
                if (item_name == "") {
                    document.getElementById("item_name").style.borderColor = "red";
                    alert("Item name must be filled out");
                    return false;
                }
                if (price == "") {
                    document.getElementById("price").style.borderColor = "red";
                    alert("Price must be filled out");
                    return false;
                }
                if (stock == "") {
                    document.getElementById("stock").style.borderColor = "red";
                    alert("Stock must be filled out");
                    return false;
                }
            }
</script>

<h3>Edit Item</h3>
<br/>

<div class="container py-5 h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-12 col-md-8 col-lg-6 col-xl-5">
        <div class="card shadow-2-strong" style="border-radius: 1rem;">
          <div class="card-body p-5 text-center">
            <form action="/edit_item_save/" name="form" method="POST" onsubmit="return validateForm()">
                {% csrf_token %}
                <h4>item</h4>
                <input type="text" id="item_name" name="item_name" value= '{{item.item}}' class="form-control" required><br/><br/>
                <h4>Price</h4>
                <input type="number" id="price" name="price" min="0" value="{{item.price}}" class="form-control" required><br/><br/>
                <h4>Stock</h4>
                <input type="number" id="stock" name="stock" min="1" value="{{item.stock}}" class="form-control" required><br/><br/>
                <input type="hidden" name="store_id" value='{{store_id}}' >
                <input type="hidden" name="item_id" value='{{item.id}}'>
                <input type="button" id="submit_button" value="submit" class="btn btn-success">
                <br/><br/>
            </form>
          <div/>
        <div/>
      <div/>
    <div/>
</div>

    <a href="{% url 'store_home' %}" class="btn btn-info">Store Home</a>



<script>
    $(document).ready(function(){
    

           //filling fields with values on reload
           window.onload=set_fields(); 

            function set_fields(){
                var item_name = sessionStorage.getItem('item_name');
                if (item_name !== null) $('#item_name').val(item_name);
                var price = sessionStorage.getItem('price');
                if (price !== null) $('#price').val(price);
                var stock = sessionStorage.getItem('stock');
                if (stock !== null) $('#stock').val(stock);
            }




            window.onbeforeunload = function() {
                sessionStorage.setItem("item_name", $('#item_name').val());
                sessionStorage.setItem("price", $('#price').val());
                sessionStorage.setItem("stock", $('#stock').val());
                // ...
            }

    
        $("#submit_button").click(function () {
            var item_name = $("#item_name").val();
    
            $.ajax({
                url: '/ajax/validate_store_edit_item/',
                data: {
                    'item_name': item_name,
                    'item_id' : '{{item.id}}'
                },
                dataType: 'json',
                success: function (data) {
                    if (data.is_taken) {
                        alert("Item already exists in store");
                        location.reload();
                    }
                    else {
                        $("form").submit();
                    }
                }
            });
            
    
        });
    });
</script>
</center>
{% endblock %}

{% block footer %}
{% endblock %}