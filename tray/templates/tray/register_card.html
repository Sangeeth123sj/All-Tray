{% extends "tray/homepage_layout.html" %}

{% block title%} Register card {% endblock %}





{% block navbar %}

<div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close mt-3">
        <span class="icon-close2 js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>



  <header class="home-site-navbar home-site-navbar-target" role="banner">

    <div class="container">
      <div class="row align-items-center position-relative">

        <div class="col-3">
          <div class="home-site-logo">
            <a href="{% url 'entry' %}" class="display-3">AllTray</a>
          </div>
        </div>

        <div class="col-9  text-right">
          

          <span class="d-inline-block d-lg-none"><a href="#" class="text-primary site-menu-toggle js-menu-toggle py-5"><span class="icon-menu h2"></span></a></span>


          <nav class="site-navigation text-right ml-auto d-none d-lg-block" role="navigation">
            <ul class="site-menu main-menu js-clone-nav ml-auto ">
              <li class="active"><a href="{% url 'entry' %}" class="nav-link ">Home</a></li>
              <!--li><a href="{% url 'your_orders' %}" class="nav-link ">Your Orders</a></li>
              <li><a href="{% url 'pay' %}" class="nav-link ">Recharge Card</a></li>
              <li><a href="{% url 'home' %}" class="nav-link ">Fee Payment</a></li>
              <li><a href="{% url 'student_pin_edit' %}" class="nav-link ">Edit Pin</a></li>
              <li><a href="{% url 'home' %}" class="nav-link "><i class="fa fa-user" aria-hidden="true"></i></a></li>
              <li><a href="{% url 'student_logout' %}" class="nav-link ">Logout</a></li-->
              
              <li><a href="#" class="nav-link ">Contact</a></li>
            </ul>
          </nav>
        </div>

        
      </div>
    </div>

    </header>

{% endblock %}





{% block content %}





<script>
    function validateForm() {
            var student_name = document.forms["form"]["student_name"].value;
            var branch_name = document.forms["form"]["branch_name"].value;
            var semester = document.forms["form"]["semester"].value;
            var password = document.forms["form"]["password"].value;
            var mail_id = document.forms["form"]["mail_id"].value;
            var college_id = document.forms["form"]["college_id"].value;
            if (student_name == "") {
                document.getElementById("student_name").style.borderColor = "red";
                alert("Please enter your name")
                return false;
            }
            if (branch_name == "") {
                document.getElementById("branch_name").style.borderColor = "red";
                alert("Please enter your branch")
                return false;
            }
            if (semester == "") {
                document.getElementById("semester").style.borderColor = "red";
                alert("Please enter your semester")
                return false;
            }
            if (password == "") {
                document.getElementById("password").style.borderColor = "red";
                alert("Please enter password.")
                return false;
            }
            if (mail_id == "") {
                document.getElementById("mail_id").style.borderColor = "red";
                alert("Please enter mail")
                return false;
            }
            if (college_id == "") {
                document.getElementById("college_id").style.borderColor = "red";
                alert("Please select college")
                return false;
            }

        }
</script>
{% load crispy_forms_tags %}




<h3>Register as student</h3>

<div class="container py-5 h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-12 col-md-8 col-lg-6 col-xl-5">
        <div class="card shadow-2-strong" style="border-radius: 1rem;">
          <div class="card-body p-5 text-center">
<form action="/register_card_post/" method="POST" name="form" onsubmit="return validateForm()">
{% csrf_token %}
{{ form|crispy }}

    
    <br/><br/>
    <div class="form-outline mb-4">
        <input type="text" class="form-control form-control-lg" id="student_name" name="student_name" required>
        <label class="form-label">Your Name</label>
    </div>

    <div class="form-outline mb-4">
        <input type="email" class="form-control form-control-lg" id="mail_id" name="mail_id" required>
        <label class="form-label">e-mail</label>
    </div>


    <h4>Branch</h4>
    <br/>
<select name="branch_name" id="branch_name" class="btn dropdown-toggle" class="btn btn-outline-primary" aria-placeholder="selects" style="background-color: azure;" class="form-control" >
    <option input value="Electronics & Communication">Electronics & Communication</option>
    <option input value="Computer Science">Computer Science</option>
    <option input value="Civil Engineering">Civil Engineering</option>
    <option input value="Mechanical Engineering">Mechanical Engineering</option>
</select>
<br/><br/>

<h4>Semester:</h4>
<select name="semester" id="semester" class="btn dropdown-toggle" class="form-control"  required style="background-color: white;">
<option input value="semester 1">semester 1</option>
<option input value="semester 2">semester 2</option>
<option input value="semester 3">semester 3</option>
<option input value="semester 4">semester 4</option>
<option input value="semester 5">semester 5</option>
<option input value="semester 6">semester 6</option>
<option input value="semester 7">semester 7</option>
<option input value="semester 8">semester 8</option>
</select>

<br/><br/>
<div class="form-outline mb-4">
    <input type="password" class="form-control form-control-lg" id="password" name="password" required>
    <label class="form-label">Password</label>
</div>


<div class="form-outline mb-4">
    <input type="text" class="form-control form-control-lg" id="card_pin" name="card_pin" required>
    <label class="form-label">Card pin</label>
</div>

{% comment %} <h4>Password</h4>
<br/>
<input type="password" name="password" id="password" minlength="4" class="form-control" >
<br/><br/>

<h4>Rfid card pin</h4>
<br/>
<input type="password" name="card_pin" id="card_pin" minlength="4" class="form-control" >
<br/><br/> {% endcomment %}

<h4>College</h4>

<select id="college_id" name="college_id" id="college_id" class="btn dropdown-toggle" aria-placeholder="selects" style="background-color: white;" >
                    
                    
    <option value="" selected disabled hidden> 
        Select an Option 
    </option> 

{% for college in colleges %}
<option input value="{{college.id}}" >{{college.institute_name}}</option>
{% endfor %}
</select>
<br/><br/>
<input type="button" id="submit_button" value="Submit" class="btn btn-primary" class="form-control">
<p id="alerter"></p>

</form>
</div>

<script>
    $(document).ready(function(){

        window.onload=set_fields(); 

        function set_fields(){
            var student_name = sessionStorage.getItem('student_name');
            if (student_name !== null) $('#student_name').val(student_name);
            var mail_id = sessionStorage.getItem('mail_id');
            if (mail_id !== null) $('#mail_id').val(mail_id);
            var branch_name = sessionStorage.getItem('branch_name');
            if (branch_name !== null) $('#branch_name').val(branch_name);
            var semester = sessionStorage.getItem('semester');
            if (semester !== null) $('#semester').val(semester);
            var password = sessionStorage.getItem('password');
            if (password !== null) $('#password').val(password);
            //var card = sessionStorage.getItem('card');
            //if (card !== null) $('#card').val(card);
            var college_id = sessionStorage.getItem('college_id');
            if (college_id !== null) $('#college_id').val(college_id);
        }

        window.onbeforeunload = function() {
            sessionStorage.setItem("student_name", $('#student_name').val());
            sessionStorage.setItem("mail_id", $('#mail_id').val());
            sessionStorage.setItem("branch_name", $('#branch_name').val());
            sessionStorage.setItem("semester", $('#semester').val());
            sessionStorage.setItem("password", $('#password').val());
            //sessionStorage.setItem("card", $('#card').val());
            sessionStorage.setItem("college_id", $('#college_id').val());
        }

        $('#password').keyup(function (){ 
                password_string = String(password);
                console.log(password_string.trim().length);
                console.log(typeof(password_string));
                console.log(password_string.length);
                console.log(String(student_name).length);
                if (String(password).length < 6) { 
                    $('#alerter').text("password too short") 
                }
            });  
        
        function checkemail(email) 
            {
                var re = /\S+@\S+\.\S+/;
                return re.test(email);
            }
        
        $("#submit_button").click(function (event) {

            var user_name = $("#student_name").val();
            var password = $("#password").val();
            var card_pin = $("#card_pin").val();
            var email = $("#mail_id").val();
            console.log(email);
            var flag = checkemail(email);
            console.log(flag);
            if (flag == false){
                alert("Please enter a valid email");
                event.preventDefault();
            }
            else{
                $.ajax({
                    url: '/ajax/student_register_validate/',
                    
                    data: {
                        'email' : email,
                        'password' : password,
                        'card_pin' : card_pin,

                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.email_taken) {
                            alert("mail id already taken, try another mail id");
                            location.reload();
                            return false;
                        }
                        else if (data.card_pin_taken){
                            alert('rfid card already registered please use another card')
                        }
                        else{
                            $("form").submit();
                        }
                    }
                });
            }
            
           
            
    
        });

    });


</script>

</center>
{%  endblock %}

{% block footer %} {% endblock %}